---
description: Manage container sandbox settings
---

# sandbox

Commands for managing container sandbox functionality.

## Subcommands

### sandbox build

Build the sandbox container image with Claude Code and workmux pre-installed.

```bash
workmux sandbox build [--force]
```

**Options:**

- `--force` - Build even on non-Linux OS (the workmux binary will not work in the image)

This builds a Docker image named `workmux-sandbox` (or your configured image name) containing Claude Code and the workmux binary. The image is built from an embedded Dockerfile template.

**Note:** This command must be run on Linux because it copies your local workmux binary into the image. On macOS/Windows, it will fail unless `--force` is used.

### sandbox auth

Authenticate with the agent inside the sandbox container. Run this once before using sandbox mode.

```bash
workmux sandbox auth
```

This starts an interactive session inside your configured sandbox container, allowing you to authenticate your agent. Credentials are saved to `~/.claude-sandbox.json`, which is separate from your host agent credentials. The host `~/.claude/` directory is mounted for settings.

### sandbox run

Run a command inside a Lima sandbox (internal, used by pane setup).

```bash
workmux sandbox run <worktree> -- <command...>
```

This is an internal command generated by `wrap_for_lima()` during pane setup. It runs the host-side supervisor process that:

1. Ensures the Lima VM is running
2. Starts a TCP RPC server on a random port
3. Runs the command inside the VM via `limactl shell`
4. Passes `WM_SANDBOX_GUEST=1`, `WM_RPC_HOST`, `WM_RPC_PORT`, and `WM_RPC_TOKEN` env vars to the guest
5. Exits with the agent command's exit code

The RPC server handles requests from the guest workmux binary:

- `SetStatus` -- updates the tmux pane status icon
- `SetTitle` -- renames the tmux window
- `Heartbeat` -- health check
- `SpawnAgent` -- runs `workmux add` on the host to create a new worktree

### sandbox install-dev

Cross-compile and install workmux into running Lima VMs for local development.

```bash
# Cross-compile and install into all running VMs
workmux sandbox install-dev

# Use release profile (slower build, faster binary)
workmux sandbox install-dev --release

# Skip compilation, copy existing binary
workmux sandbox install-dev --skip-build
```

**Options:**

- `--skip-build` - Skip cross-compilation and copy the previously built binary
- `--release` - Use release profile (default is debug for faster iteration)

This is a developer-only command for getting local workmux builds into Lima VMs. The host macOS binary is a Mach-O binary that cannot run inside the Linux VM, so this command cross-compiles for the correct Linux architecture and copies the result into each running VM.

**Prerequisites:**

- Rust cross-compilation target: `rustup target add aarch64-unknown-linux-gnu`
- Cross-linker: `brew install messense/macos-cross-toolchains/aarch64-unknown-linux-gnu`

The binary is installed to `~/.local/bin/workmux` inside the VM, which is already on PATH.

### sandbox stop

Stop Lima VMs to free resources.

```bash
# Interactive mode - show list and select VM
workmux sandbox stop

# Stop specific VM
workmux sandbox stop <vm-name>

# Stop all workmux VMs
workmux sandbox stop --all

# Skip confirmation prompt
workmux sandbox stop --all --yes
```

**Arguments:**

- `<vm-name>` - Name of the VM to stop (optional, conflicts with `--all`)

**Options:**

- `--all` - Stop all workmux VMs (those starting with `wm-` prefix)
- `-y, --yes` - Skip confirmation prompt

This command helps you stop running Lima VMs created by workmux to free up system resources. When run without arguments, it shows an interactive list of running workmux VMs for you to choose from. The command will ask for confirmation before stopping any VMs unless `--yes` is provided.

**Notes:**

- This command only works with Lima backend and requires `limactl` to be installed
- Only running VMs are shown in interactive mode
- If a specified VM is already stopped, the command reports this and exits successfully
- Non-interactive environments (pipes, scripts) require `--all` or a specific VM name

## Quick Setup

```bash
# 1. Build the image (on Linux)
workmux sandbox build

# 2. Authenticate
workmux sandbox auth

# 3. Enable in config (~/.config/workmux/config.yaml or .workmux.yaml)
#    sandbox:
#      enabled: true
```

## Example

```bash
# Build the sandbox image
workmux sandbox build
# Output:
# Building sandbox image 'workmux-sandbox'...
# Building image 'workmux-sandbox' using docker...
# ...
# Sandbox image built successfully!

# Then authenticate
workmux sandbox auth
# Output:
# Starting sandbox auth flow...
# This will open Claude in container 'workmux-sandbox' for authentication.
# Your credentials will be saved to ~/.claude-sandbox.json
#
# [Interactive agent session]
#
# Auth complete. Sandbox credentials saved.
```

## See also

- [Container sandbox guide](/guide/sandbox) for full setup instructions
